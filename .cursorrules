# AI Agent for Website - Cursor Rules

This file contains instructions for Cursor AI when working on this WordPress plugin.

## Mandatory Checks Before Committing

### 1. CI/CD Pipeline
- Always verify that CI/CD workflows will pass before committing
- Check `.github/workflows/` for any pipeline configurations
- Ensure all automated tests are passing

### 2. PHPCS (PHP CodeSniffer)
- Always run PHPCS before committing any PHP changes:
  ```bash
  vendor/bin/phpcs --standard=phpcs.xml .
  ```
- Fix any coding standard violations before committing
- Use `vendor/bin/phpcbf` for automatic fixes when possible

### 3. WordPress Coding Standards
- Follow WordPress Coding Standards for all PHP, CSS, and JavaScript code
- Use proper escaping functions (`esc_html()`, `esc_attr()`, `wp_kses()`, etc.)
- Use proper sanitization for all user inputs
- Follow WordPress naming conventions (snake_case for functions/variables)
- Use proper internationalization with `__()`, `_e()`, `esc_html__()`, etc.
- Prefix all functions, classes, and hooks with `aaw_` (AI Agent for Website)

### 4. Changelog and Version
- Update `CHANGELOG.md` for any new features, bug fixes, or changes
- Follow the existing changelog format (Keep a Changelog)
- Update version number in the following files when releasing:
  - `ai-agent-for-website.php` (Plugin header and constant)
  - `readme.txt` (Stable tag)
- Use semantic versioning (MAJOR.MINOR.PATCH)

## Code Quality Guidelines

### PHP
- Minimum PHP version: Check `composer.json` for requirements
- Use strict type declarations where appropriate
- Document functions with proper PHPDoc comments
- Use WordPress Database API (`$wpdb`) for database operations
- Use WordPress HTTP API (`wp_remote_*`) for external requests

### JavaScript
- Use vanilla JavaScript or jQuery (WordPress bundled version)
- Properly enqueue scripts with dependencies
- Use `wp_localize_script()` for passing data to JavaScript

### CSS
- Use proper prefixing for custom classes
- Follow BEM naming convention where applicable
- Ensure responsive design

## Testing

### 5. Test Coverage Requirements (MANDATORY)
- **All new functions and classes MUST have corresponding test cases**
- Tests are located in the `tests/` directory
- Test files follow the naming convention: `{ClassName}Test.php`
- Run PHPUnit tests before any commit:
  ```bash
  vendor/bin/phpunit --testdox
  ```
- Minimum test coverage: 100+ tests must pass
- CI/CD will fail if test coverage requirements are not met

### Test File Structure
- `tests/bootstrap.php` - Test bootstrap with WordPress mocks
- `tests/APIConnectionTest.php` - API key validation tests
- `tests/FileProcessorTest.php` - File processing tests
- `tests/ChatWidgetTest.php` - Chat widget tests
- `tests/KnowledgeManagerTest.php` - Knowledge base tests
- `tests/LeadsManagerTest.php` - Lead management tests
- `tests/NotificationManagerTest.php` - Notification tests
- `tests/ActivityLogManagerTest.php` - Activity log tests
- `tests/RESTAPITest.php` - REST API endpoint tests
- `tests/IntegrationsTest.php` - Third-party integration tests
- `tests/AdminSettingsTest.php` - Admin settings tests
- `tests/LiveAgentManagerTest.php` - Live agent tests
- `tests/ConversationsManagerTest.php` - Conversation tests
- `tests/PluginTest.php` - Main plugin tests
- `tests/PluginUpdaterTest.php` - Plugin updater tests

### Adding New Tests
When adding new functionality:
1. Create or update the corresponding test file
2. Add tests for all public methods
3. Test edge cases and error conditions
4. Ensure all tests pass before committing
5. CI/CD pipeline will verify test coverage

### API Keys for Testing
- Use `api-keys.local.php` for local API keys (gitignored)
- Copy from `api-keys.local.php.example` template
- Tests run in `AIAGENT_TEST_MODE` with mock responses

### Additional Testing Guidelines
- Test in multiple WordPress versions when possible
- Test with WordPress Multisite if applicable

## Security
- Never trust user input - always sanitize and validate
- Use nonces for all form submissions and AJAX requests
- Check user capabilities before performing actions
- Escape all output

